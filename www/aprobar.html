<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>Solicitudes por Aprobar</title>
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css">
  <!-- jQuery and jQuery Mobile -->
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script> 
  <script src="js/utils.js" type="text/javascript"></script>
</head>
<body>
<!-- Home -->
<div data-role="page" id="page1" >
    
        <ul data-role="listview" data-autodividers="true" id="listFacturas" data-filter="false"  data-inset="true">
            <li><center><img src="img/ajax-loader.gif" alt=""/></center></li>
        </ul>
    
</div>
<script>
    
    var GSTRDATOS;
    var GBLINFORMACIONCARGADA=false;
    
    GURL +="14";
    
    function localData(){
        $('#listFacturas').empty();
        document.querySelector('#listFacturas').innerHTML=GSTRDATOS;
        $('#listFacturas').listview('refresh');
    }
    
    function getData(){
         if (!GBLINFORMACIONCARGADA){
            callAjax();
        }else{
            localData();
        }
    }
  
    function callAjax() {
        $.post(GURL, { intEmpresa: "1", intConsulta: "37" }, null, "text")
            .done(function(data) {
                data = parseXML(data);
                if(data==null)
                        return;
                $('#listFacturas').empty();
                $(data).find("Table").each(function() {
                    var objOT = $(this);
                        document.querySelector('#listFacturas').innerHTML += 
                                "<li group='"+objOT.find("strGrupo").text()+"'>"+
                                "<a href='javascript:parent.verSolicitud("+objOT.find("intSolicitudChequeEnc").text()+");'>"+
                                "<h3>" +objOT.find("strProveedor").text()+"</h3>"+
                                "<p>Concepto "+objOT.find("strConcepto").text()+"</p>"+
                                "<p>Fecha "+objOT.find("datFechaSolicitud").text()+"</p>"+
                                "<p>Total "+numberWithCommas(objOT.find("dblTotal").text())+"</p>"+
                                "</a>"
                                "</li>";
                        
                   
                })
                GSTRDATOS=document.querySelector('#listFacturas').innerHTML;
                $( "#listFacturas" ).listview({
                    autodividers: true,
                    autodividersSelector: function ( li ) {
                      var out = li.attr('group');
                      return out;
                    }
                  });
                $('#listFacturas').listview('refresh');
                GBLINFORMACIONCARGADA=true;
            }
        );
    }
    getData();


    function doOnOrientationChange(){
        switch (window.orientation){
        case - 90:
            case 90:
                getData();
                break;
            default:
                getData();
                break;
        }
    }
    window.addEventListener('orientationchange', doOnOrientationChange);
    
</script>
</body>
</html>